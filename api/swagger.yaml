openapi: 3.0.3
info:
  title: CJ
  description: "Social Network VK"
  version: 1.0.0-oas3
servers:
  - url: /api
security:
  - CookieAuth: []

paths:
  /auth/signup:
    post:
      tags:
        - Authorization
      summary: Signup user
      security: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupUserRequest"
        required: true
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SignupUserResponse"

  /auth/login:
    post:
      tags:
        - Authorization
      summary: Login user
      security: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginUserRequest"
        required: true
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginUserResponse"

  /auth/logout:
    delete:
      tags:
        - Authorization
      summary: Logout user
      security: []
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BasicResponse"

  /user/get:
    get:
      tags:
        - User
      summary: Get user data
      security: []
      parameters:
        - $ref: "#/components/parameters/userIDParam"
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUserResponse"

  /user/posts:
    get:
      tags:
        - User
      summary: Get user's posts
      parameters:
        - $ref: "#/components/parameters/userIDParam"
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUserPostsResponse"

  /user/feed:
    get:
      tags:
        - User
      summary: Get feed
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUserFeedResponse"

  /user/profile:
    get:
      tags:
        - Profile
      summary: Get user profile
      parameters:
        - $ref: "#/components/parameters/userIDParam"
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUserProfileResponse"

  /user/profile/edit:
    post:
      tags:
        - Profile
      summary: Edit info about user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EditUserProfileRequest"
        required: true
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EditUserProfileResponse"

  /friends/request:
    post:
      tags:
        - Friends
      summary: Send a friend request
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReqSendRequest"
        required: true
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReqSendResponse"

  /friends/accept:
    post:
      tags:
        - Friends
      summary: Accept friend request
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AcceptRequest"
        required: true
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AcceptResponse"

  /friends/delete:
    put:
      tags:
        - Friends
      summary: Delete friend
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DeleteFriendRequest"
        required: true
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteFriendResponse"

  /friends/get:
    get:
      tags:
        - Friends
      summary: Get my friends
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetFriendsResponse"

  /friends/requests:
    get:
      tags:
        - Friends
      summary: Get my requests
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetRequestsResponse"

  /post/create:
    post:
      tags:
        - Post
      summary: Create new post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePostRequest"
        required: true
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreatePostResponse"

  /post/delete:
    delete:
      tags:
        - Post
      summary: Delete post
      parameters:
        - $ref: "#/components/parameters/postIDParam"
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BasicResponse"

  /post/edit:
    put:
      tags:
        - Post
      summary: Edit post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PostEditRequest"
        required: true
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PostEditResponse"

  /post/get:
    get:
      tags:
        - Post
      summary: Get post
      parameters:
        - $ref: "#/components/parameters/postIDParam"
      responses:
        "500":
          description: Internal error
          content: {}
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetPostResponse"

components:
  parameters:
    userIDParam:
      in: query
      name: user_id
      required: false
      schema:
        type: string
      description: On empty user_id currently authorized user's id is used

    exFriendIDParam:
      in: query
      name: ex_friend_id
      required: true
      schema:
        type: string

    postIDParam:
      in: query
      name: post_id
      required: true
      schema:
        type: string

  securitySchemes:
    CookieAuth:
      type: apiKey
      in: cookie
      name: AuthToken

  schemas:
    # --------------------- Models --------------------- #

    SignupUserRequest:
      type: object
      properties:
        name:
          $ref: "#/components/schemas/UserName"
        email:
          type: string
          example: mail@example.com
        password:
          type: string
          example: password

    SignupUserResponse:
      $ref: "#/components/schemas/BasicResponse"

    LoginUserRequest:
      type: object
      properties:
        email:
          type: string
          example: mail@example.com
        password:
          type: string
          example: password

    LoginUserResponse:
      $ref: "#/components/schemas/BasicResponse"

    GetUserResponse:
      $ref: "#/components/schemas/User"

    GetUserPostsResponse:
      type: object
      properties:
        post_ids:
          type: array
          items:
            type: string

    GetUserProfileResponse:
      $ref: "#/components/schemas/UserProfile"


    EditUserProfileRequest:
      type: object
      properties:
        new_info:
          type: object
          properties:
            name:
              $ref: "#/components/schemas/UserName"
            avatar:
              type: string
              example: fmt/img/avatar.jpg
            phone:
              type: string
              example: +8(800)-555-35-35
            location:
              type: string
              example: Moscow
            birth_day:
              type: string
              example: 01.02.2018

    EditUserProfileResponse:
      $ref: "#/components/schemas/UserProfile"

    ReqSendRequest:
      type: object
      properties:
        person_id:
          type: string
          example: 123-oe-rtey

    ReqSendResponse:
      $ref: "#/components/schemas/BasicResponse"

    AcceptRequest:
      type: object
      properties:
        person_id:
          type: string
          example: 123-oe-rtey
        is_accepted:
          type: boolean
          example: true

    AcceptResponse:
      $ref: "#/components/schemas/Requests"

    DeleteFriendRequest:
      type: object
      properties:
        ex_friend_id:
          type: string
          example: 123-oe-rtey

    DeleteFriendResponse:
      $ref: "#/components/schemas/Friends"

    GetFriendsResponse:
      $ref: "#/components/schemas/Friends"

    GetRequestsResponse:
      $ref: "#/components/schemas/Requests"

    GetUserFeedResponse:
      type: object
      properties:
        post_ids:
          type: array
          items:
            type: string

    CreatePostRequest:
      type: object
      properties:
        message:
          type: string
          example: This is my new post
        images:
          type: array
          items:
            type: string
            example: src/image.jpg

    CreatePostResponse:
      $ref: "#/components/schemas/Post"

    PostEditRequest:
      type: object
      properties:
        post_id:
          type: string
        message:
          type: string
          example: This is my new post
        images:
          type: array
          items:
            type: string
            example: src/image.jpg

    PostEditResponse:
      $ref: "#/components/schemas/Post"

    GetPostResponse:
      $ref: "#/components/schemas/Post"

    # --------------------- Models --------------------- #

    BasicResponse:
      type: object

    User:
      type: object
      properties:
        user:
          type: object
          properties:
            id:
              type: string
            name:
              $ref: "#/components/schemas/UserName"
            email:
              type: string
              example: mail@example.com

    UserName:
      type: object
      properties:
        first:
          type: string
          example: John
        last:
          type: string
          example: Doe

    UserProfile:
      type: object
      properties:
        user_profile:
          type: object
          properties:
            user_info:
              $ref: "#/components/schemas/User"
            avatar:
              type: string
              example: fmt/img/avatar.jpg
            phone:
              type: string
              example: +8(800)-555-35-35
            location:
              type: string
              example: Moscow
            birth_day:
              type: string
              example: 01.02.2018
            friend_ids:
              type: array
              items:
                type: string
              example: [friend_id1, friend_id2]
            post_ids:
              type: array
              items:
                type: string
              example: [post_id1, post_id2]

    Requests:
      type: object
      properties:
        requests_id:
          type: array
          items:
            type: string
          example: [123-oe-rtey, 5933-owe-rdsatey]

    Friends:
      type: object
      properties:
        friends_id:
          type: array
          items:
            type: string
          example: [123-oe-rtey, 5933-owe-rdsatey]

    Post:
      type: object
      properties:
        post:
          type: object
          properties:
            author_id:
              type: string
            post_id:
              type: string
            message:
              type: string
            images:
              type: array
              items:
                type: string